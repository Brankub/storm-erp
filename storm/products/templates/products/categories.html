{% extends "base.html" %}

{% set pagetitle='Product categories' %}


{% macro tree(objects, class='', id='') %}
  {% for obj, is_branch, children in objects recursive  %}
    <li data-id="{{ obj.id }}" class="tree-row level-{{ loop.depth }}{% if is_branch %} collapsed branch{% else %} leaf{% endif %}">
      <a class="toggle-children" href="#">Expand</a>
      <div class="element">
        <span class="handle"></span>
        {{ caller(obj) }}
      </div>
      {% if is_branch %}
        <ol>
          {{ loop(children) }}
        </ol>
      {% endif %}
    </li>
  {% endfor %}
{% endmacro %}

{% block content %}
  <h1>{{ pagetitle }}</h1>
  <main>
    <ol class="tree tree-sortable categories-tree" data-sorting-endpoint="{{ url_for('.move_category') }}">
      {% call(category) tree(object_list) %}
        <div class="tree-row-label">
          <div><a href="{{ url_for('.edit_category', category_id=category.id) }}">{{ category.name }}</a></div>
        </div>
        <div class="delete"><a href="{{ url_for('.delete_category', object_id=category.id) }}">{{ icon('times') }} Remove</a></div>
      {% endcall %}
    </ol>
  </main>
{% endblock %}
